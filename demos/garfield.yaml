---
namespaces:
  - name: demo-project
    labels:
      opendatahub.io/dashboard: "true"
      kueue.openshift.io/managed: "true"
    annotations:
      openshift.io/description: Project for resources for Internal AI Project (Demo)
      openshift.io/display-name: Demo Project
applications:
  - name: monitoring
  - name: aws-nvidia-gpu-machinesets
    fileprefix: l40s
    rewrite:
      metadata:
        name: machineset-l40s
    values:
      instanceType: g6e.2xlarge
      desiredReplicas: 1
      baseName: worker-l40s
      taints:
        - key: nvidia.com/gpu
          value: l40s
          effect: NoSchedule
      nodeLabels:
        node-role.kubernetes.io/gpu: ""
        jharmison.dev/gpu-type: l40s
  - name: nvidia-gpu-enablement
  - name: oauth
    secrets:
      providers:
        htpasswd:
          demouser: openshift
  - name: kueue-operator
  - name: openshift-ai
    values:
      channel: fast
      dataScienceCluster:
        components:
          codeflare:
            managementState: Managed
          ray:
            managementState: Managed
          llamastackoperator:
            managementState: Managed
          kueue:
            managementState: Unmanaged
          feastoperator:
            managementState: Managed
      dashboardConfig:
        disableModelCatalog: false
        disableHardwareProfiles: false
        disableLMEval: false
        disableFineTuning: false
        disableKueue: false
      acceleratorProfiles: []
      modelServerSizes: []
      notebookSizes: []
      hardwareProfiles:
        - name: default
          displayName: Default (CPU only)
          global: true
          identifiers:
            - defaultCount: 2
              displayName: CPU
              identifier: cpu
              maxCount: 6
              minCount: 1
              resourceType: CPU
            - defaultCount: 4Gi
              displayName: Memory
              identifier: memory
              maxCount: 24Gi
              minCount: 2Gi
              resourceType: Memory
          scheduling:
            type: Queue
            kueue:
              localQueueName: default
              priorityClass: None
        - name: l40s
          displayName: NVIDIA L40s
          namespace: demo-project
          identifiers:
            - defaultCount: 4
              displayName: CPU
              identifier: cpu
              maxCount: 6
              minCount: 1
              resourceType: CPU
            - defaultCount: 8Gi
              displayName: Memory
              identifier: memory
              maxCount: 48Gi
              minCount: 4Gi
              resourceType: Memory
            - defaultCount: 1
              displayName: NVIDIA L40s
              identifier: nvidia.com/gpu
              maxCount: 1
              minCount: 1
              resourceType: Accelerator
          scheduling:
            type: Queue
            kueue:
              localQueueName: default
              priorityClass: None
  - name: kueue
    values:
      resourceFlavors:
        - name: default
        - name: l40s
          spec:
            nodeLabels:
              jharmison.dev/gpu-type: l40s
            tolerations:
              - effect: NoSchedule
                key: nvidia.com/gpu
                operator: Equal
                value: l40s
      clusterQueues:
        - name: l40s
          resourceGroups:
            - coveredResources: ["cpu", "memory"]
              flavors:
                - name: default
                  resources:
                    - name: cpu
                      nominalQuota: 16
                    - name: memory
                      nominalQuota: 64Gi
            - coveredResources: ["nvidia.com/gpu"]
              flavors:
                - name: l40s
                  resources:
                    - name: nvidia.com/gpu
                      nominalQuota: 1
          localQueues:
            - namespace: demo-project
              name: default
  - name: rbac
    values:
      clusterRoles:
        - name: rbac-viewer-namespaced
          rules:
            - apiGroups:
                - rbac.authorization.k8s.io
              resources:
                - rolebindings
                - roles
              verbs:
                - get
                - list
                - watch
        - name: rbac-viewer-cluster
          rules:
            - apiGroups:
                - rbac.authorization.k8s.io
              resources:
                - clusterroles
              verbs:
                - get
                - list
                - watch
        - name: accelerator-profiles-viewer
          rules:
            - apiGroups:
                - dashboard.opendatahub.io
              resources:
                - acceleratorprofiles
              verbs:
                - get
                - list
                - watch
      clusterRoleBindings:
        - name: clusterqueue-viewer
          roleRef:
            apiGroup: rbac.authorization.k8s.io
            kind: ClusterRole
            name: kueue-clusterqueue-viewer-role
          subjects:
            - apiGroup: rbac.authorization.k8s.io
              kind: User
              name: demouser
        - name: resourceflavor-viewer
          roleRef:
            apiGroup: rbac.authorization.k8s.io
            kind: ClusterRole
            name: kueue-resourceflavor-viewer-role
          subjects:
            - apiGroup: rbac.authorization.k8s.io
              kind: User
              name: demouser
        - name: clusterrole-viewer
          roleRef:
            apiGroup: rbac.authorization.k8s.io
            kind: ClusterRole
            name: rbac-viewer-cluster
          subjects:
            - apiGroup: rbac.authorization.k8s.io
              kind: User
              name: demouser
      roleBindings:
        - name: demouser-edit
          namespace: demo-project
          roleRef:
            apiGroup: rbac.authorization.k8s.io
            kind: ClusterRole
            name: edit
          subjects:
            - apiGroup: rbac.authorization.k8s.io
              kind: User
              name: demouser
        - name: demouser-kueue-user
          namespace: demo-project
          roleRef:
            apiGroup: rbac.authorization.k8s.io
            kind: ClusterRole
            name: kueue-batch-user-role
          subjects:
            - apiGroup: rbac.authorization.k8s.io
              kind: User
              name: demouser
        - name: demouser-rbac-viewer
          namespace: demo-project
          roleRef:
            apiGroup: rbac.authorization.k8s.io
            kind: ClusterRole
            name: rbac-viewer-namespaced
          subjects:
            - apiGroup: rbac.authorization.k8s.io
              kind: User
              name: demouser
        - name: demouser-acceleratorprofile-viewer
          namespace: demo-project
          roleRef:
            apiGroup: rbac.authorization.k8s.io
            kind: ClusterRole
            name: accelerator-profiles-viewer
          subjects:
            - apiGroup: rbac.authorization.k8s.io
              kind: User
              name: demouser
        - name: rhoai-users
          namespace: redhat-ods-applications
          roleRef:
            apiGroup: rbac.authorization.k8s.io
            kind: ClusterRole
            name: view
          subjects:
            - apiGroup: rbac.authorization.k8s.io
              kind: User
              name: demouser
