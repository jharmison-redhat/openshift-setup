---
namespaces:
  - name: project1
    labels:
      opendatahub.io/dashboard: "true"
      kueue.openshift.io/managed: "true"
    annotations:
      openshift.io/description: Project for resources for Internal AI Project 1
      openshift.io/display-name: Project 1
  - name: project2
    labels:
      opendatahub.io/dashboard: "true"
      kueue.openshift.io/managed: "true"
    annotations:
      openshift.io/description: Project for resources for Internal AI Project 2
      openshift.io/display-name: Project 2
applications:
  - name: monitoring
  - name: aws-nvidia-gpu-machinesets
    fileprefix: l40s
    rewrite:
      metadata:
        name: machineset-l40s
    values:
      instanceType: g6e.2xlarge
      desiredReplicas: 2
      baseName: worker-l40s
      taints:
        - key: nvidia.com/gpu
          value: l40s
          effect: NoSchedule
      nodeLabels:
        node-role.kubernetes.io/gpu: ""
        jharmison.dev/gpu-type: l40s
  - name: aws-nvidia-gpu-machinesets
    fileprefix: t4
    rewrite:
      metadata:
        name: machineset-t4
    values:
      instanceType: g4dn.2xlarge
      desiredReplicas: 2
      baseName: worker-t4
      taints:
        - key: nvidia.com/gpu
          value: t4
          effect: NoSchedule
      nodeLabels:
        node-role.kubernetes.io/gpu: ""
        jharmison.dev/gpu-type: t4
  - name: nvidia-gpu-enablement
  - name: oauth
    secrets:
      providers:
        htpasswd:
          project1user: openshift
          project2user: openshift
  - name: kueue-operator
  - name: openshift-ai
    values:
      channel: fast
      dataScienceCluster:
        components:
          ray:
            managementState: Managed
          llamastackoperator:
            managementState: Managed
          kueue:
            managementState: Unmanaged
      dashboardConfig:
        disableModelCatalog: false
        disableHardwareProfiles: false
        disableLMEval: false
        disableFineTuning: false
        disableKueue: false
      acceleratorProfiles: []
      modelServerSizes: []
      notebookSizes: []
      hardwareProfiles:
        - name: default
          displayName: Default (CPU only)
          global: true
          identifiers:
            - defaultCount: 2
              displayName: CPU
              identifier: cpu
              maxCount: 6
              minCount: 1
              resourceType: CPU
            - defaultCount: 4Gi
              displayName: Memory
              identifier: memory
              maxCount: 24Gi
              minCount: 2Gi
              resourceType: Memory
          scheduling:
            type: Queue
            kueue:
              localQueueName: default
              priorityClass: None
        - name: l40s
          displayName: NVIDIA L40s
          namespace: project1
          identifiers:
            - defaultCount: 4
              displayName: CPU
              identifier: cpu
              maxCount: 6
              minCount: 1
              resourceType: CPU
            - defaultCount: 8Gi
              displayName: Memory
              identifier: memory
              maxCount: 24Gi
              minCount: 4Gi
              resourceType: Memory
            - defaultCount: 1
              displayName: NVIDIA L40s
              identifier: nvidia.com/gpu
              maxCount: 1
              minCount: 1
              resourceType: Accelerator
          scheduling:
            type: Queue
            kueue:
              localQueueName: default
              priorityClass: None
        - name: t4
          displayName: NVIDIA T4
          namespace: project2
          identifiers:
            - defaultCount: 2
              displayName: CPU
              identifier: cpu
              maxCount: 6
              minCount: 1
              resourceType: CPU
            - defaultCount: 4Gi
              displayName: Memory
              identifier: memory
              maxCount: 16Gi
              minCount: 4Gi
              resourceType: Memory
            - defaultCount: 1
              displayName: NVIDIA T4
              identifier: nvidia.com/gpu
              resourceType: Accelerator
              maxCount: 1
              minCount: 1
          scheduling:
            type: Queue
            kueue:
              localQueueName: default
              priorityClass: None
  - name: kueue
    values:
      resourceFlavors:
        - name: default
        - name: l40s
          spec:
            nodeLabels:
              jharmison.dev/gpu-type: l40s
            tolerations:
              - effect: NoSchedule
                key: nvidia.com/gpu
                operator: Equal
                value: l40s
        - name: t4
          spec:
            nodeLabels:
              jharmison.dev/gpu-type: t4
            tolerations:
              - effect: NoSchedule
                key: nvidia.com/gpu
                operator: Equal
                value: t4
      clusterQueues:
        - name: l40s
          resourceGroups:
            - coveredResources: ["cpu", "memory"]
              flavors:
                - name: default
                  resources:
                    - name: cpu
                      nominalQuota: 16
                    - name: memory
                      nominalQuota: 64Gi
            - coveredResources: ["nvidia.com/gpu"]
              flavors:
                - name: l40s
                  resources:
                    - name: nvidia.com/gpu
                      nominalQuota: 2
          localQueues:
            - namespace: project1
              name: default
        - name: t4
          resourceGroups:
            - coveredResources: ["cpu", "memory"]
              flavors:
                - name: default
                  resources:
                    - name: cpu
                      nominalQuota: 16
                    - name: memory
                      nominalQuota: 64Gi
            - coveredResources: ["nvidia.com/gpu"]
              flavors:
                - name: t4
                  resources:
                    - name: nvidia.com/gpu
                      nominalQuota: 2
          localQueues:
            - namespace: project2
              name: default
  - name: rbac
    values:
      clusterRoleBindings:
        - name: project1user-clusterqueue-viewer
          roleRef:
            apiGroup: rbac.authorization.k8s.io
            kind: ClusterRole
            name: kueue-clusterqueue-viewer-role
          subjects:
            - apiGroup: rbac.authorization.k8s.io
              kind: User
              name: project1user
        - name: project1user-resourceflavor-viewer
          roleRef:
            apiGroup: rbac.authorization.k8s.io
            kind: ClusterRole
            name: kueue-resourceflavor-viewer-role
          subjects:
            - apiGroup: rbac.authorization.k8s.io
              kind: User
              name: project1user
        - name: project2user-clusterqueue-viewer
          roleRef:
            apiGroup: rbac.authorization.k8s.io
            kind: ClusterRole
            name: kueue-clusterqueue-viewer-role
          subjects:
            - apiGroup: rbac.authorization.k8s.io
              kind: User
              name: project2user
        - name: project2user-resourceflavor-viewer
          roleRef:
            apiGroup: rbac.authorization.k8s.io
            kind: ClusterRole
            name: kueue-resourceflavor-viewer-role
          subjects:
            - apiGroup: rbac.authorization.k8s.io
              kind: User
              name: project2user
      roleBindings:
        - name: project1user-edit
          namespace: project1
          roleRef:
            apiGroup: rbac.authorization.k8s.io
            kind: ClusterRole
            name: edit
          subjects:
            - apiGroup: rbac.authorization.k8s.io
              kind: User
              name: project1user
        - name: project1user-kueue-user
          namespace: project1
          roleRef:
            apiGroup: rbac.authorization.k8s.io
            kind: ClusterRole
            name: kueue-batch-user-role
          subjects:
            - apiGroup: rbac.authorization.k8s.io
              kind: User
              name: project1user
        - name: project2user-edit
          namespace: project2
          roleRef:
            apiGroup: rbac.authorization.k8s.io
            kind: ClusterRole
            name: edit
          subjects:
            - apiGroup: rbac.authorization.k8s.io
              kind: User
              name: project2user
        - name: project2user-kueue-user
          namespace: project2
          roleRef:
            apiGroup: rbac.authorization.k8s.io
            kind: ClusterRole
            name: kueue-batch-user-role
          subjects:
            - apiGroup: rbac.authorization.k8s.io
              kind: User
              name: project2user
        - name: rhoai-users
          namespace: redhat-ods-applications
          roleRef:
            apiGroup: rbac.authorization.k8s.io
            kind: ClusterRole
            name: view
          subjects:
            - apiGroup: rbac.authorization.k8s.io
              kind: User
              name: project1user
            - apiGroup: rbac.authorization.k8s.io
              kind: User
              name: project2user
